---
interface Props {
  title: string;
  author: string;
  dateAdded: Date;
  url: string;
  comments?: string;
  type: "video" | "article" | "blog" | "academic";
  classList?: string;
}

const { title, author, dateAdded, url, comments, type, classList } =
  Astro.props;

const iconMap = {
  video:
    '<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m15 10l4.553-2.276A1 1 0 0 1 21 8.618v6.764a1 1 0 0 1-1.447.894L15 14zM3 8a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v8a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>',
  article:
    '<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm4 2h10M7 12h10M7 16h10" />',
  blog: '<path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 6a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2zm4 2h10M7 12h10M7 16h10" />',
  academic:
    '<g fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"><path d="M22 9L12 5L2 9l10 4zv6" /><path d="M6 10.6V16a6 3 0 0 0 12 0v-5.4" /></g>',
};

const currentIcon = iconMap[type] || iconMap.article;
const date = new Date(dateAdded).toLocaleDateString();
---

<article
  class:list={[
    "bookmark-item first:border-t last:border-b py-4 border-zinc-300 text-zinc-800 fade-in",
    classList,
  ]}
>
  <div class="flex items-center justify-between">
    <div class="flex min-w-0 gap-2">
      <svg
        xmlns="http://www.w3.org/2000/svg"
        width="18"
        height="18"
        viewBox="0 0 24 24"
        fill="none"
        stroke="currentColor"
        stroke-width="2"
        stroke-linecap="round"
        stroke-linejoin="round"
        class="mt-[0.175rem] shrink-0"
        set:html={currentIcon}
      />

      <div class="min-w-0">
        <h3
          class="text-base font-semibold leading-snug tracking-tight truncate hover:underline"
        >
          <a target="_blank" href={url} class="">{title}</a>
        </h3>
        <p class="text-sm leading-snug tracking-wide truncate text-zinc-600">
          {author} &middot; added {date}
        </p>
      </div>
    </div>
    {
      comments && (
        <button
          class="pl-2 ml-2 transition-all cursor-pointer comment-toggle shrink-0 hover:text-zinc-600 hover:scale-110"
          aria-label="Toggle comment"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            width="20"
            height="20"
            viewBox="0 0 24 24"
          >
            <path
              fill="none"
              stroke="currentColor"
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="1.5"
              d="M8 9h8m-8 4h6m4-9a3 3 0 0 1 3 3v8a3 3 0 0 1-3 3h-5l-5 3v-3H6a3 3 0 0 1-3-3V7a3 3 0 0 1 3-3z"
            />
          </svg>
        </button>
      )
    }
  </div>
  {
    comments && (
      <p class="comment-content hidden text-zinc-600 ml-6.5 text-sm mt-2">
        {comments}
      </p>
    )
  }
</article>

<style>
  .hidden {
    display: none;
  }
</style>

<script>
  const bookmarks = document.querySelectorAll(".bookmark-item");

  bookmarks.forEach((bookmark) => {
    const btn = bookmark.querySelector(".comment-toggle");
    const content = bookmark.querySelector(".comment-content");

    btn?.addEventListener("click", () => {
      content?.classList.toggle("hidden");
    });
  });
</script>
